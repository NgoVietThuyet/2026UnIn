<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChÃºc má»«ng nÄƒm má»›i 2026 á»¦n á»ˆn</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="ui-layer">
      <h1>á»¦n á»‰n nháº¥n vÃ o Ä‘iðŸ’—</h1>
    </div>

    <canvas id="heartCanvas"></canvas>

    <div id="gallery-overlay" class="hidden">
      <div class="gallery-content">
        <h2>Ká»· niá»‡m cá»§a chÃºng ta</h2>
        <div class="photo-grid" id="photo-grid"></div>
        <a href="letter.html" class="letter-button">Bá»©c thÆ° táº·ng á»¦n á»‰n ðŸ’Œ</a>
        <button id="close-gallery">Quay láº¡i</button>
      </div>
    </div>
    <audio id="my-audio" loop>
      <source src="assets/Mucsic/River Flows In You.mp3" type="audio/mpeg" />
    </audio>

    <button id="music-btn" onclick="toggleMusic()">ðŸŽµ</button>

    <style>
      #music-btn {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 9999; /* LuÃ´n ná»•i lÃªn trÃªn cÃ¹ng */
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.8);
        border: 2px solid #e91e63;
        border-radius: 50%;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: spin 3s linear infinite; /* Xoay trÃ²n khi hÃ¡t */
        animation-play-state: paused; /* Máº·c Ä‘á»‹nh Ä‘á»©ng yÃªn */
      }

      #music-btn:hover {
        transform: scale(1.1);
        background: #fff;
      }

      @keyframes spin {
        100% {
          transform: rotate(360deg);
        }
      }
    </style>

    <script>
      const audio = document.getElementById("my-audio");
      const btn = document.getElementById("music-btn");

      // --- HÃ€M 1: KHÃ”I PHá»¤C TRáº NG THÃI NHáº C Tá»ª TRANG TRÆ¯á»šC ---
      window.addEventListener("DOMContentLoaded", () => {
        // Láº¥y thá»i gian Ä‘Ã£ phÃ¡t tá»« bá»™ nhá»›
        const savedTime = localStorage.getItem("musicTime");
        const isPlaying = localStorage.getItem("musicPlaying");

        if (savedTime) {
          audio.currentTime = parseFloat(savedTime);
        }

        // Náº¿u tráº¡ng thÃ¡i lÃ  Ä‘ang phÃ¡t -> Tá»± Ä‘á»™ng phÃ¡t tiáº¿p
        // (LÆ°u Ã½: TrÃ¬nh duyá»‡t cÃ³ thá»ƒ cháº·n náº¿u chÆ°a click, ta sáº½ xá»­ lÃ½ á»Ÿ dÆ°á»›i)
        if (isPlaying === "true") {
          audio
            .play()
            .then(() => {
              btn.style.animationPlayState = "running";
              btn.innerHTML = "ðŸŽµ";
            })
            .catch(() => {
              console.log("TrÃ¬nh duyá»‡t cháº·n Autoplay, chá» ngÆ°á»i dÃ¹ng click...");
            });
        } else {
          btn.style.animationPlayState = "paused";
          btn.innerHTML = "ðŸ”‡"; // Biá»ƒu tÆ°á»£ng táº¯t tiáº¿ng
        }
      });

      // --- HÃ€M 2: LÆ¯U THá»œI GIAN KHI CHUYá»‚N TRANG ---
      window.addEventListener("beforeunload", () => {
        localStorage.setItem("musicTime", audio.currentTime);
        localStorage.setItem("musicPlaying", !audio.paused);
      });

      // --- HÃ€M 3: Báº¬T/Táº®T NHáº C KHI Báº¤M NÃšT ---
      function toggleMusic() {
        if (audio.paused) {
          audio.play();
          btn.style.animationPlayState = "running";
          btn.innerHTML = "ðŸŽµ";
          localStorage.setItem("musicPlaying", "true");
        } else {
          audio.pause();
          btn.style.animationPlayState = "paused";
          btn.innerHTML = "ðŸ”‡";
          localStorage.setItem("musicPlaying", "false");
        }
      }

      // --- HÃ€M 4: CLICK Báº¤T Ká»² ÄÃ‚U Äá»‚ Má»’I NHáº C (FIX Lá»–I CHROME) ---
      // Chrome cháº·n tá»± phÃ¡t nháº¡c náº¿u chÆ°a tÆ°Æ¡ng tÃ¡c.
      // HÃ m nÃ y giÃºp nháº¡c tá»± báº­t ngay khi báº¡n cháº¡m vÃ o mÃ n hÃ¬nh láº§n Ä‘áº§u.
      document.body.addEventListener(
        "click",
        () => {
          if (
            localStorage.getItem("musicPlaying") !== "false" &&
            audio.paused
          ) {
            audio.play();
            btn.style.animationPlayState = "running";
            btn.innerHTML = "ðŸŽµ";
          }
        },
        { once: true }
      ); // Chá»‰ cháº¡y 1 láº§n duy nháº¥t
    </script>
    <script src="script.js"></script>
  </body>
</html>
